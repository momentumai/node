var bignum = require('bignum'),
    crypto = require('crypto'),
    opt = {
        'epoch': Date.UTC(2000, 0, 1),
        'timebits': 41
    },
    mask = bignum(2).pow(64).sub(1);

function simpleflake () {
    var timebits = opt.timebits,
        seqbits = 64 - timebits,
        ts = bignum(Date.now() - opt.epoch),
        seq = bignum.fromBuffer(crypto.randomBytes(Math.ceil(seqbits / 8))),
        buf = bignum.or(
            ts.shiftLeft(seqbits),
            seq.and(mask.shiftRight(timebits))
        ).toBuffer();

    return String(bignum.fromBuffer(buf).toString(10));
}

module.exports = simpleflake;
