var Promise = require('bluebird'),
    AWS = require('aws-sdk'),
    config = require('@config'),
    extend = require('extend'),
    logger = require('@lib/logger')('cloudwatch'),
    cloudwatch = {};

cloudwatch.init = function () {
    return Promise.resolve(new AWS.CloudWatch(
        extend({}, config.AWS, config.cloudwatch)
    ));
};

cloudwatch.getMetricStatistics = function (params, cw) {
    logger.info('cloudwatch params:', params);

    return new Promise(function (resolve, reject) {
        cw.getMetricStatistics(params, function (err, data) {
            if (err) {
                reject(err);
            }

            logger.info('cloudwatch response:', data);

            return resolve(data && data.Datapoints || []);
        });
    });
};

module.exports = cloudwatch;
