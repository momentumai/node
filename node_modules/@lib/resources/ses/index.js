var Promise = require('bluebird'),
    AWS = require('aws-sdk'),
    config = require('@config'),
    logger = require('@lib/logger')('ses'),
    ses = {};

function init () {
    return Promise.resolve(new AWS.SES(config.AWS));
}

ses.sendEmail = function (email, emailData) {
    logger.info('email to ' + email);
    return init().then(function (sesRes) {
        return new Promise(function (resolve, reject) {
            sesRes.sendEmail({
                'Source': 'zoltan@momentum.ai',
                'Destination': {
                    'ToAddresses': [
                        email
                    ]
                },
                'Message': {
                    'Subject': {
                        'Data': emailData.subject
                    },
                    'Body': {
                        'Text': {
                            'Data': emailData.message
                        }
                    }
                }
            }, function (err, data) {
                if (err) {
                    return reject(err);
                }
                return resolve(data);
            });
        });
    });
};

module.exports = ses;
