SELECT
    rule.*,
    IFNULL(category1.name, 'ALL') AS cat1name,
    IFNULL(category2.name, 'ALL') AS cat2name,
    IFNULL(category3.name, 'ALL') AS cat3name,
    IFNULL(team_user_data.value, '{}') AS options,
    IF(
        IFNULL(team_user_data.user_id, {{user_id}}) = {{user_id}},
        1,
        0
    ) AS my
FROM rule
LEFT JOIN category AS category1
ON cat1 = category1.id
LEFT JOIN category AS category2
ON cat2 = category2.id
LEFT JOIN category AS category3
ON cat3 = category3.id
LEFT JOIN team_user_data
ON team_user_data.team_id = {{team_id}} AND
    team_user_data.key = CONCAT('rule_', rule.id)
WHERE rule.team_id = {{team_id}};
