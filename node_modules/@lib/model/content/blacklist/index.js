var ds = require('@lib/resources/ds'),
    Promise = require('bluebird'),
    blacklist = {};

blacklist.update = function (teamId, url, blacklist) {
    var content = ds.extend('Content', url, function (item) {
            item.is_blacklisted = Boolean(blacklist);
            return item;
        }, teamId),
        bl = ds.extend('BlacklistedContent', teamId, function (item) {
            item.contents = item.contents || [];
            if (blacklist) {
                if (item.contents.indexOf(url) === -1) {
                    item.contents.push(url);
                }
            } else {
                item.contents = item.contents.filter(function (act) {
                    return act !== url;
                });
            }
            return item;
        });

    return Promise.all([
        content,
        bl
    ]).then(function () {
        return {};
    });
};

module.exports = blacklist;
