var dynamo = require('@lib/resources/dynamodb'),
    ds = require('@lib/resources/datastore'),
    urlUtils = require('@lib/utils/url'),
    info = {};

info.get = function (teamId, contentId) {
    return dynamo.init().then(function (dynamodb) {
        return dynamo.getItem(
            'content',
            [teamId, contentId].join('-'),
            '1',
            dynamodb
        );
    }).then(function (content) {
        content = content || {};

        if (content.range) {
            delete content.range;
        }

        Object.keys(content).forEach(function (key) {
            if (['title', 'author'].indexOf(key) !== -1) {
                content[key] = new Buffer(
                    content[key],
                    'base64'
                ).toString('utf8');
            }
        });

        content.share_link = urlUtils.addShareParams(content.url);

        return ds.get(teamId, 'Content', content.url).then(function (data) {
            if (data && data.is_blacklisted) {
                content.blacklist = true;
            } else {
                content.blacklist = false;
            }

            return content;
        });
    });
};

module.exports = info;
