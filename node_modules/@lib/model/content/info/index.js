var ds = require('@lib/resources/datastore'),
    publicInfo = require('@lib/model/content/public-info'),
    extend = require('extend'),
    info = {};

info.get = function (teamId, contentId) {
    var content = {};

    return ds.init(teamId).then(function (datastore) {
        var query = datastore.createQuery('Content');

        query.filter('content_id', contentId);

        return ds.runQuery(query, datastore).then(function (results) {
            content.url = results[0].key.name;
            content.cats = results[0].category_map ||
                '["NONE", "NONE", "NONE"]';

            content.cats = JSON.parse(content.cats);

            return publicInfo.get(teamId, content.url);
        });
    }).then(function (ogdata) {
        content = extend({}, content, ogdata);

        content.title = ogdata.title || content.url;
        content.site_name = ogdata.site_name || '';
        content.image = ogdata.image || '';
        content.description = ogdata.description || '';

        return content;
    });
};

module.exports = info;
