var ds = require('@lib/resources/ds'),
    publicInfo = require('@lib/model/content/public-info'),
    extend = require('extend'),
    info = {};

info.get = function (teamId, contentId) {
    var content = {};

    return ds.query('Content', function (query) {
        return query.filter('content_id', contentId);
    }, teamId).then(function (results) {
        content.id = results[0].data.content_id;
        content.url = results[0].key.name;
        content.cats = results[0].data.category_map;
        content.cats = content.cats.split('||');
        content.cats[0] = content.cats[0] || 'NONE';
        content.cats[1] = content.cats[1] || 'NONE';
        content.cats[2] = content.cats[2] || 'NONE';

        return publicInfo.get(teamId, content.url);
    }).then(function (ogdata) {
        content = extend({}, content, ogdata);

        content.title = ogdata.title || content.url;
        content.site_name = ogdata.site_name || '';
        content.image = ogdata.image || '';
        content.description = ogdata.description || '';

        return content;
    });
};

module.exports = info;
