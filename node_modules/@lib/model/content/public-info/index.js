var memcached = require('@lib/resources/memcached'),
    Facebook = require('@lib/utils/facebook'),
    info = {};

function getOgAndSetMemcache (teamId, url, memcacheResource) {
    return Facebook.getOgData(url).then(function (content) {
        return memcached.set({
            'team_id': teamId,
            'type': 'content-public-info',
            'key': url,
            'value': content
        }, memcacheResource).then(function () {
            return content;
        });
    });
}

info.get = function (teamId, url) {
    var mResource;

    return memcached.init().then(function (res) {
        mResource = res;

        return memcached.get({
            'team_id': teamId,
            'type': 'content-public-info',
            'key': url
        }, mResource);
    }).then(function (content) {
        if (!content.title) {
            return getOgAndSetMemcache(teamId, url, mResource);
        }

        return content;
    });
};

module.exports = info;
