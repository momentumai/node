var ds = require('@lib/resources/datastore'),
    Promise = require('bluebird'),
    filter = {};

filter.list = function (teamId) {
    return ds.init(teamId).then(function (datastore) {
        var query = datastore.createQuery('Category').select('__key__');

        return ds.runQuery(query, datastore);
    }).then(function (rows) {
        var result = {};
        
        rows.forEach(function (row) {
            var cats = row.key.name.split('||');

            cats[0] = cats[0] || 'NONE';
            cats[1] = cats[1] || 'NONE';
            cats[2] = cats[2] || 'NONE';

            result[cats[0]] = result[cats[0]] || {};
            result[cats[0]][cats[1]] = result[cats[0]][cats[1]] || {};
            result[cats[0]][cats[1]][cats[2]] = {};
        });

        return result;
    });

};

module.exports = filter;
