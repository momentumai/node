var path = require('path'),
    db = require('@lib/resources/db'),
    sqlUtils = require('@lib/utils/sql'),
    q = sqlUtils.getQueries(path.join(__dirname, 'sql')),
    category = {};

category.list = function (teamId, parent, pool) {
    var params = {
        'team_id': teamId,
        'parent': parent || 0
    };

    return db.q(
        q['category'],
        params,
        pool
    ).then(function (rows) {
        var categories = [{
            'id': 'all',
            'label': 'ALL'
        }];

        rows.forEach(function (row) {
            if (row.name !== 'NONE') {
                categories.push({
                    'id': row.id,
                    'label': unescape(row.name)
                });
            }
        });

        return categories;
    });
};

module.exports = category;
