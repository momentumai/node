SELECT
    email,
    payment_amount,
    IFNULL(is_super, 0) as is_super,
    IFNULL(is_admin OR is_super, 0) as is_admin,
    IFNULL(CONCAT('{',
      GROUP_CONCAT(
        CONCAT(
          '"',
          SUBSTR(team_user_data.key, 7),
          '":"',
          team_user_data.value,
          '"'
        )
      ),
      '}' 
    ), '{}') guide
FROM
      user
LEFT JOIN
      team_user
ON
    team_user.user_id = user.id AND
    team_user.team_id = {{team_id}}
LEFT JOIN
    team_user_data
ON
    team_user_data.user_id = user.id AND
    team_user_data.team_id = {{team_id}} AND
    `key` BETWEEN 'guide_' AND 'guide`'
LEFT JOIN team
ON team.id = team_user.team_id
WHERE
    user.id = {{user_id}}
GROUP BY email;
