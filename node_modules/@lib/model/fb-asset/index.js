var Promise = require('bluebird'),
    Facebook = require('@lib/utils/facebook'),
    property = {};

property.list = function (token) {
    var promises = {};

    promises.pages = property.fbPages(token);
    promises.adaccounts = property.fbAdAccounts(token);
    promises.businesses = property.fbBusinesses(token);

    return Promise.props(promises);
};

property.get = function (token) {
    return Facebook.get(
        'me?fields=adaccounts{name,id},accounts{name,id}',
        token
    ).then(function (res) {
        var ret = [];

        (
            res.adaccounts &&
            res.adaccounts.data ||
            []
        ).forEach(function (account) {
            ret.push({
                'type': 'adaccount',
                'value': account.id,
                'display': account.name
            });
        });

        (
            res.accounts &&
            res.accounts.data ||
            []
        ).forEach(function (page) {
            ret.push({
                'type': 'page',
                'value': page.id,
                'display': page.name
            });
        });

        return ret;
    });
};

module.exports = property;
