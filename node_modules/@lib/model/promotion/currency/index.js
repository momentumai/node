var Facebook = require('@lib/utils/facebook'),
    path = require('path'),
    fs = require('fs'),
    currency = {};

currency.format = function (value, currency, offseted) {
    value = Number(value);
    if (Number.isNaN(value)) {
        return 'N/A';
    }
    if (!offseted) {
        value /= currency.offset || 1;
    }
    return value.toLocaleString('en-EN', {
        'style': 'currency',
        'currency': currency.name || 'GBP',
        'maximumSignificantDigits': 4
    });
};

currency.get = function (token, adAccountId) {
    var url = adAccountId + '?fields=currency';

    return Facebook.get(url, token).then(function (data) {
        var resp = {
                'name': data.currency,
                'offset': 0
            },
            currencies = fs.readFileSync(
                path.join(__dirname, 'currencies.txt'),
                'utf8'
            );

        currencies = currencies.split('\n');
        currencies.forEach(function (item) {
            item = item.split('-');
            if (item[0] === data.currency) {
                resp.offset = Number(item[1]);
            }
        });

        return resp;
    });
};

module.exports = currency;
