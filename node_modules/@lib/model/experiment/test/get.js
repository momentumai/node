var ds = require('@lib/resources/ds'),
    fbAdsetModel = require('@lib/model/fb/adset');

module.exports = function (key, token) {
    var test;

    return ds.get('ExperimentTest', key.name, key.namespace)
    .then(function (resp) {
        test = resp;
        return fbAdsetModel.getDetails(
            test.data.adset,
            token
        );
    }).then(function (resp) {
        return {
            'id': test.key.name,
            'experiment_id': test.data.experiment_id,
            'adaccount': resp.adaccount,
            'page': test.data.page,
            'audience_id': test.data.audience_id,
            'name': test.data.name_text,
            'active': test.data.active,
            'end_time': test.data.end_time,
            'start_time': test.data.created_at,
            'click': test.data.click,
            'budget': resp.budget,
            'spend': resp.spend,
            'fb_actions': resp.fb_actions,
            'has_permission': resp.has_permission
        };
    });
};
