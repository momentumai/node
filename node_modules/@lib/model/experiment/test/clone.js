var ds = require('@lib/resources/ds'),
    createExperiment = require('@lib/model/experiment/create');

function parseParams (p) {
    var params = {};

    params.team_id = p.team_id || 0;
    params.id = p.id;

    return params;
}

module.exports = function (params, token) {
    params = parseParams(params);

    return ds.get('ExperimentTest', params.id, params.team_id)
    .then(function (test) {
        params.test = test.data;
        params.name_text = ['Clone - ', params.test.name_text].join('');
        params.delta_time = params.test.end_time - params.test.start_time;

        return createExperiment({
            'team_id': params.team_id,
            'name_text': params.name_text,
            'audience_id': params.test.audience_id,
            'adaccount': params.test.adaccount,
            'page': params.test.page,
            'budget': params.test.budget,
            'end_time': (new Date().getTime() + params.delta_time) / 1000,
            'content_id': params.test.experiment_id.name,
            'utm': params.test.utm,
            'tests': [params.test.creative]
        }, token);
    });
};
